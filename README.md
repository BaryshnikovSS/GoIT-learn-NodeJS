# GoIT-learn-NodeJS-basics




## Работа с базой данных MongoDB

Документ db-contacts хранит в себе коллекцию contacts в формате json.

- Код для создания подключения к MongoDB написан при помощи
  [Mongoose](https://mongoosejs.com/).
  - При успешном подключении выводится в консоль сообщение
    `"Database connection successful"`.
  - В случае ошибки подключения выводиться в консоль сообщение об ошибке
    и процесс завершаеться с помощью `process.exit(1)`.




## Работа с REST API

REST API поддерживает следующие рауты:

### @ GET /api/contacts

- ничего не получает
- возвращает массив всех контактов в json-формате со статусом `200`
- имеет возможность настройки пагинации на пример `/contacts?page=1&limit=20`

### @ GET /api/contacts/:contactId

- Не получает `body`
- Получает параметр `contactId`
- если такой `id` есть, возвращает обьект контакта в json-формате со статусом `200`
- если такого `id` нет, возвращает json-файл с ключом `{"message": "Not found"}` и
  статусом `404`

### @ POST /api/contacts

- Получает `body` в формате `{name, email, phone}`
- Если в `body` нет каких-то обязательных полей, возарщает json-файл с ключом
  `{"message": "missing required name field"}` и статусом `400`
- Если с `body` все хорошо, добавляет уникальный идентификатор в обьект контакта
- Сохраняет новий контакт в базе данных
- По результату успешного выполнения работы возвращает обьект с добавленным `id`
  `{id, name, email, phone}` и статусом `201`
- Добавлена возможность получения необходимого количества документов на странице - `limit`, 
выбора отдаваемой страницы - `page`, а также получения документов по фильтру `sub` - `subscription` 
при условии указания в адресной строке параметров `query`.
- Пагинация доступна благодаря [mongoose-paginate-v2](https://www.npmjs.com/package/mongoose-paginate-v2).  

### @ PATCH /api/contacts/:contactId

- Получает `body` в json-формате c возможностью обновления любых полей `name, email и phone`
- Если `body` нет, возарщает json с ключом `{"message": "missing fields"}` и
  статусом `400`
- Если с `body` все хорошо, обновляеться контакт в базе данных 
- По результату успешного выполнения работы возвращает обновленный обьект контакта со
  статусом `200`. 
- В противном случае, возвращает json-файл с ключом
  `{"message": "Not found"}` и статусом `404`

### @ DELETE /api/contacts/:contactId

- Не получает `body`
- Получает параметр `contactId`
- если такой `id` есть, возвращает json формата `{"message": "contact deleted"}` со
  статусом `200`
- если такого `id` нет, возвращает json-файл с ключом `{"message": "Not found"}` и
  статусом `404`

### @ POST /auth/register

- Получает `body` в формате `{email, password}`
- Если в `body` нет каких-то обязательных полей, возарщает json-файл с ключом `{"message": "Missing required fields"}` 
и статусом `422`
- Если почта уже используется кемто другим, возвращает json-файл с ключом `{"message": "Email in use"}` и статусом `400`
- В случае успешной валидации создаеться пользователь по данным которого была пройдена валидация. Добавлена 
возможность генерации и добавления аватарки новому пользоваьелю во время его регистрации с помощью [avatar-builder](https://www.npmjs.com/package/avatar-builder). Для засолки паролей используеться [bcrypt](https://www.npmjs.com/package/bcrypt).
- Если все хорошо, возвращает json-файл с ключом `{"token": "exampletoken", "user": {"email": "example@example.com", "subscription": "free"}}` и статусом `201`
- 

### @ POST /auth/login

- Получает `body` в формате `{email, password}`
- Если в `body` нет каких-то обязательных полей, возарщает json-файл с ключом `{"message": "Missing required fields"}` и статусом `422`
- Если с `body` все хорошо, осуществляеться валидация пароля найденного юзера
- Если пароли совпадают создаеться токен, сохраняеться в текущем юзере и возвращает json-файл с ключом `{"token": "exampletoken", "user": {"email": "example@example.com", "subscription": "free"}}`и статусом `200`
- Если пароль не верный возвращает json-файл с ключом `{"message": "Wrong login or password"}` и статусом `400`

### @ POST /auth/logout

- Получает токен из заголовков `Authorization`, проверяет токен на валидность.
- В случае не валидного токена возвращает json-файл с ключом `{"message": "Not authorized"}` и статусом `401`
- Находит пользователя по `id`.
- В случае успешного прохождения валидации удаляет токен в текущем юзере и возвращает json-файл с ключом `{"message": "Logout success"}` и статусом `200`

### @ POST /users/current

- Получает токен из заголовков `Authorization`, проверяет токен на валидность.
- В случае не валидного токена возвращает json-файл с ключом `{"message": "Not authorized"}` и статусом `401`
- Находит пользователя по `id`.
- В случае успешного прохождения валидации возвращает json-файл с ключом `{"email": "example@example.com", "subscription": "free"}` и статусом `200`

### @ PATCH /users

- Получает `body` в формате `{email, subscription}`
- В случае не валидного `subscription` или отсутствия `email` в `body` возвращает json-файл 
с ключом `{"message": "Not authorized"}` и статусом `401`
- Находит пользователя по `id`.
- В случае успешного прохождения валидации возвращает json-файл с ключом `{"email": "example@example.com", "subscription": "updateSubscription"}` и статусом `200`

### @ GET /public/images/avatar-***.ext

- Получает ссылку на статический файл аватарки пользователя 

### @ PATCH /users/avatars

- Получает токен из заголовков `Authorization`, проверяет токен на валидность.
- В случае не валидного токена возвращает json-файл с ключом `{"message": "Not authorized"}` и статусом `401`
- Получает `body` c загружаемым графическим файлом, который обязан иметь ключ `avatar`
- Находит пользователя по `id`.
- В случае успешного прохождения валидации возвращает json-файл с ключом `{"avatarURL": "example@example.com"}` и статусом `200`


